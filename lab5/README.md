# Лабораторная 2
## Задача
1. Настроить консул ( использовать уже готовую роль и инветори).
2. База данных должна быть проинициализирована на выделенных дисках (в Vargrantfile они уже подключены). VG должна называться pg, LV pg_data и pg_wal соответственно. Точки монтирования разделов /pgsql/pg_data и /pgsql/pg_wal. Файловая система для обоих LVM ext4.
3. БД должна находиться в папке /pgsql/pg_data/14. WAL архивы должны находиться в папке /pgsql/pg_wal/14.
4. На серверах pg1 и pg2 настроить оркестратор репликации Patroni (пакет в архиве).
5. С помощью утилиты vip-manager обеспечить настройку VIP адреса на мастер сервере. Напоминаю, что в конфиге vip-manager необходимо настроить подключение по DCS Consul. IP адрес подключения 127.0.0.1:8500. Так же нужно будет указать consul_token, переменную которого можно взять в роли consul.
6. В Postgres залить уже знакомую нам БД small из https://edu.postgrespro.ru/demo-small-20161013.zip
7. АБСОЛЮТНО ВСЕ ПЕРЕМЕННЫЕ, использующиеся в playbook должны быть заданы в едином group_vars.
P.S. Если кто не в понял, то всё нужно делать в ansible



## Ход работы
Работа выполнялась на MacOS с использованием Vagrant версии 2.4.1, VMware Fusion и vagrant плагина для работы с VMware вместо VirtualBox

Почему VMware? - VirtualBox у меня нестабильно работал, вылетал и позже был удален

Вследствие есть ограничение по сравнению с VirtualBox - невозможность задать статические IP адреса виртуальным машинам. Но я нашел выход с использованием dhcp (см. [Vagrantfile](Vagrantfile))

Демонстрация работы:

    Virtual IP - 172.16.98.100
![alt text](image.png)
![alt text](image-1.png)